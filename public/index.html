<!DOCTYPE html>
<html lang="en">
<head>
    <title>Grid Game</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚔️</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- SETUP SCREEN OVERLAY -->
<div id="setup-screen" class="modal-overlay">
    <div class="modal-content large-modal">
        <h1>Create New Game</h1>

        <div class="global-settings">
            <div class="form-group">
                <label for="cfg-grid-size">Map Size (Grid):</label>
                <input type="number" id="cfg-grid-size" value="50" min="20" max="100">
            </div>
        </div>

        <h3>Player Slots</h3>
        <div class="slots-container">
            <!-- Slot 1 -->
            <div class="player-slot" style="border-left: 5px solid #e74c3c;"> <!-- Red -->
                <div class="slot-header">Top (Red)</div>
                <select class="slot-type" id="slot-0-type">
                    <option value="me" selected>Me (Host)</option>
                    <option value="ai">AI Bot</option>
                    <option value="open">Open (Human)</option>
                    <option value="closed">Closed</option>
                </select>
                <div class="slot-gold-group">
                    <label>Gold:</label>
                    <input type="number" class="slot-gold" id="slot-0-gold" value="2000" step="100">
                </div>
                <div class="slot-diff-group hidden">
                    <label>Difficulty:</label>
                    <select class="slot-diff" id="slot-0-diff">
                        <option value="easy">Easy</option>
                        <option value="normal" selected>Normal</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>

            <!-- Slot 2 -->
            <div class="player-slot" style="border-left: 5px solid #3498db;"> <!-- Blue -->
                <div class="slot-header">Bottom (Blue)</div>
                <select class="slot-type" id="slot-1-type">
                    <option value="me">Me (Host)</option>
                    <option value="ai" selected>AI Bot</option>
                    <option value="open">Open (Human)</option>
                    <option value="closed">Closed</option>
                </select>
                <div class="slot-gold-group">
                    <label>Gold:</label>
                    <input type="number" class="slot-gold" id="slot-1-gold" value="2000" step="100">
                </div>
                <div class="slot-diff-group">
                    <label>Difficulty:</label>
                    <select class="slot-diff" id="slot-1-diff"> <!-- Visible by default since AI is selected -->
                        <option value="easy">Easy</option>
                        <option value="normal" selected>Normal</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>

            <!-- Slot 3 -->
            <div class="player-slot" style="border-left: 5px solid #2ecc71;"> <!-- Green -->
                <div class="slot-header">Left (Green)</div>
                <select class="slot-type" id="slot-2-type">
                    <option value="me">Me (Host)</option>
                    <option value="ai">AI Bot</option>
                    <option value="open">Open (Human)</option>
                    <option value="closed" selected>Closed</option>
                </select>
                <div class="slot-gold-group hidden">
                    <label>Gold:</label>
                    <input type="number" class="slot-gold" id="slot-2-gold" value="2000" step="100">
                </div>
                <div class="slot-diff-group hidden">
                    <label>Difficulty:</label>
                    <select class="slot-diff" id="slot-2-diff">
                        <option value="easy">Easy</option>
                        <option value="normal" selected>Normal</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>

            <!-- Slot 4 -->
            <div class="player-slot" style="border-left: 5px solid #f1c40f;"> <!-- Yellow -->
                <div class="slot-header">Right (Yellow)</div>
                <select class="slot-type" id="slot-3-type">
                    <option value="me">Me (Host)</option>
                    <option value="ai">AI Bot</option>
                    <option value="open">Open (Human)</option>
                    <option value="closed" selected>Closed</option>
                </select>
                <div class="slot-gold-group hidden">
                    <label>Gold:</label>
                    <input type="number" class="slot-gold" id="slot-3-gold" value="2000" step="100">
                </div>
                <div class="slot-diff-group hidden">
                    <label>Difficulty:</label>
                    <select class="slot-diff" id="slot-3-diff">
                        <option value="easy">Easy</option>
                        <option value="normal" selected>Normal</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>
        </div>

        <button id="btn-start-game" class="primary-btn">Start Game</button>
        <p class="modal-note">Warning: Starting a game resets the current board.</p>
    </div>
</div>

<div id="app-container">
    <!-- LEFT: Players & Battle Log -->
    <div id="left-panel">
        <h2>Chivalry 3</h2>

        <!-- Status Indicator -->
        <h3 id="status" class="game-status">Waiting for players...</h3>

        <!-- Standardized Buttons -->
        <button id="btn-new-game-trigger" class="panel-main-btn btn-blue">New Game</button>
        <button id="end-turn-btn" class="panel-main-btn btn-red">END TURN</button>

        <div id="connection-status" class="connection-status">Connecting...</div>

        <!-- Collapsible Player List -->
        <div class="panel-section">
            <div class="panel-header">
                <h3>Players</h3>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="panel-content">
                <ul id="player-list"></ul>
            </div>
        </div>

        <!-- Collapsible Battle Log -->
        <div id="log-panel-container" class="panel-section">
            <div class="panel-header">
                <h3>Battle Log</h3>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="panel-content">
                <div id="log-content"></div>
            </div>
        </div>
    </div>

    <!-- CENTER: Game Board -->
    <div id="game-area">
        <!-- Floating Text Overlay -->
        <div id="overlay-layer" class="overlay-layer"></div>

        <div class="canvas-wrapper">
            <canvas id="gameCanvas" width="1000" height="1000"></canvas>

            <!-- Minimap Canvas (Smaller size: 150x150) -->
            <canvas id="minimap" width="150" height="150"></canvas>

            <!-- Context Menu -->
            <div id="context-menu">
                <button id="btn-attack">Attack</button>
                <button id="btn-rotate">Rotate</button>
                <button id="btn-deselect" class="danger">Deselect</button>
            </div>
        </div>

        <p class="instructions">
            Click to Move/Select. Right-click or Menu to Attack/Rotate.<br>
            Scroll to Zoom. Spawn units during your turn in your base.
        </p>
    </div>

    <!-- RIGHT: Recruitment & Stats -->
    <div id="right-panel">

        <!-- Collapsible Recruitment -->
        <div class="panel-section">
            <div class="panel-header">
                <h3>Recruitment</h3>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="panel-content">
                <div id="toolbar">
                    <!-- New Units Templates -->
                    <div class="template" data-type="light_infantry">Light Inf</div>
                    <div class="template" data-type="heavy_infantry">Heavy Inf</div>
                    <div class="template" data-type="archer">Archer</div>
                    <div class="template" data-type="light_cavalry">Light Cav</div>
                    <div class="template" data-type="heavy_cavalry">Heavy Cav</div>
                    <div class="template" data-type="spearman">Spearman</div>
                    <div class="template" data-type="catapult">Catapult</div>
                </div>
            </div>
        </div>

        <!-- Collapsible Troop Stats -->
        <div class="panel-section">
            <div class="panel-header">
                <h3>Troop Stats</h3>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="panel-content">
                <div id="unit-info-panel" class="info-panel">
                    <div id="unit-info-content"><em>Click a unit to see details</em></div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<!-- Client Modules in dependency order -->
<script src="renderer.js"></script>
<script src="uiManager.js"></script>
<script src="game.js"></script>
</body>
</html>