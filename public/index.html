<!DOCTYPE html>
<html lang="en">
<head>
    <title>Grid Game</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚔️</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- SETUP SCREEN OVERLAY -->
<div id="setup-screen" class="modal-overlay">
    <div class="modal-content">
        <h1>Create New Game</h1>
        <div class="form-group">
            <label for="cfg-grid-size">Grid Size (20-100):</label>
            <input type="number" id="cfg-grid-size" value="50" min="20" max="100">
        </div>
        <div class="form-group">
            <label for="cfg-gold">Starting Gold:</label>
            <input type="number" id="cfg-gold" value="2000" min="500" step="100">
        </div>
        <div class="form-group">
            <label for="cfg-ai-count">AI Players (0-3):</label>
            <input type="number" id="cfg-ai-count" value="0" min="0" max="3">
        </div>
        <div class="form-group">
            <label for="cfg-ai-difficulty">AI Difficulty:</label>
            <select id="cfg-ai-difficulty">
                <option value="easy">Easy (Rookie)</option>
                <option value="normal" selected>Normal (Tactician)</option>
                <option value="hard">Hard (Strategist)</option>
            </select>
        </div>
        <button id="btn-start-game" class="primary-btn">Start Game</button>
        <p class="modal-note">Starting a new game will reset the board for everyone.</p>
    </div>
</div>

<div id="app-container">
    <!-- LEFT: Players & Battle Log -->
    <div id="left-panel">
        <h2>Chivalry 3</h2>

        <!-- Status Indicator -->
        <h3 id="status" class="game-status">Waiting for players...</h3>

        <!-- Standardized Buttons -->
        <button id="btn-new-game-trigger" class="panel-main-btn btn-blue">New Game</button>
        <button id="end-turn-btn" class="panel-main-btn btn-red">END TURN</button>

        <div id="connection-status" class="connection-status">Connecting...</div>

        <!-- Collapsible Player List -->
        <div class="panel-section">
            <div class="panel-header">
                <h3>Players</h3>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="panel-content">
                <ul id="player-list"></ul>
            </div>
        </div>

        <div id="log-panel">
            <h3 class="log-header">Battle Log</h3>
            <div id="log-content"></div>
        </div>
    </div>

    <!-- CENTER: Game Board -->
    <div id="game-area">
        <!-- Floating Text Overlay -->
        <div id="overlay-layer" class="overlay-layer"></div>

        <div class="canvas-wrapper">
            <canvas id="gameCanvas" width="1000" height="1000"></canvas>

            <!-- Minimap Canvas (Smaller size: 150x150) -->
            <canvas id="minimap" width="150" height="150"></canvas>

            <!-- Context Menu -->
            <div id="context-menu">
                <button id="btn-attack">Attack</button>
                <button id="btn-rotate">Rotate</button>
                <button id="btn-deselect" class="danger">Deselect</button>
            </div>
        </div>

        <p class="instructions">
            Click to Move/Select. Right-click or Menu to Attack/Rotate.<br>
            Scroll to Zoom. Spawn units during your turn in your base.
        </p>
    </div>

    <!-- RIGHT: Recruitment & Stats -->
    <div id="right-panel">

        <!-- Collapsible Recruitment -->
        <div class="panel-section">
            <div class="panel-header">
                <h3>Recruitment</h3>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="panel-content">
                <div id="toolbar">
                    <!-- New Units Templates -->
                    <div class="template" data-type="light_infantry">Light Inf</div>
                    <div class="template" data-type="heavy_infantry">Heavy Inf</div>
                    <div class="template" data-type="archer">Archer</div>
                    <div class="template" data-type="light_cavalry">Light Cav</div>
                    <div class="template" data-type="heavy_cavalry">Heavy Cav</div>
                    <div class="template" data-type="spearman">Spearman</div>
                    <div class="template" data-type="catapult">Catapult</div>
                </div>
            </div>
        </div>

        <!-- Collapsible Troop Stats -->
        <div class="panel-section">
            <div class="panel-header">
                <h3>Troop Stats</h3>
                <span class="toggle-icon">▼</span>
            </div>
            <div class="panel-content">
                <div id="unit-info-panel" class="info-panel">
                    <div id="unit-info-content"><em>Click a unit to see details</em></div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<!-- Client Modules in dependency order -->
<script src="renderer.js"></script>
<script src="uiManager.js"></script>
<script src="game.js"></script>
</body>
</html>